<!DOCTYPE html>
<html>
<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script src="./bundle.js"></script>
  <script>
    $(function () {
      var $input = $('#input')

      var completer = new MentionCompleter({
        patterns: {
          username: /(@[\w]+)\b/,
          hashtag: /(#[\w]+)\b/
        },
        getValue: function (cb) {
          cb(null, $input.val())
        },
        setValue: function (value) {
          $input.focus()
          $input.val(value)
          completer.checkForMatch()
        },
        getSelectionRange: function (cb) {
          cb(null, {
            start: $input[0].selectionStart,
            end: $input[0].selectionEnd
          })
        },
        setSelectionRange: function (range) {
          $input[0].setSelectionRange(range.start, range.end)
        }
      })

      // setTimeout because selection range is outdated on mousedown:
      $input.on('mousedown keyup select', function () {
        setTimeout(completer.checkForMatch.bind(completer))
      })

      completer
        .on('nomatch', createMatchUI)
        .on('match', function (match) {
          createMatchUI(match.value, match.type)
        })

      $('#completions').on('click','li a', function () {
        completer.replaceMatch(completer.mostRecentMatch, $(this).html())
      })

      function createMatchUI(value, type) {
        $('#match').text(value || '')
        $('#matchtype').text(type || '')
        var html = ''
        if (value && type ) {
          if (type === 'username') {
            var html = ''
            html += '<li><a href="javascript:void(0)">@handle1</a></li>'
            html += '<li><a href="javascript:void(0)">@handle2</a></li>'
            html += '<li><a href="javascript:void(0)">@handle3</a></li>'
          } else if (type === 'hashtag') {
            html += '<li><a href="javascript:void(0)">#hashtag1</a></li>'
            html += '<li><a href="javascript:void(0)">#hashtag2</a></li>'
            html += '<li><a href="javascript:void(0)">#hashtag3</a></li>'
          }
        }
        $('#completions').html(html)
      }
    })
  </script>
</head>
<body>
  <textarea
    id="input"
    placeholder="Type some text with a @usernames and #hashtags"
    rows="10"
    cols="70"
  ></textarea>
  <p><b>Match:</b> <span id="match"></span></p>
  <p><b>Match type:</b> <span id="matchtype"></span></p>

  <p>
    <b>Completions:</b>
    <ul id="completions"></ul>
  </p>

</body>
</html>
